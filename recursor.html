<!DOCTYPE html>

<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />

  <!-- Set the viewport width to device width for mobile -->
  <meta name="viewport" content="width=device-width" />

  <title>PowerDNS Control Center</title>
  
  <!-- Included CSS Files (Uncompressed) -->
  <!--
  <link rel="stylesheet" href="stylesheets/foundation.css">
  -->

  <link rel="stylesheet" href="DataTables-1.9.4/media/css/demo_page.css">
  <link rel="stylesheet" href="DataTables-1.9.4/media/css/demo_table.css">  
  <link rel="stylesheet" href="DataTables-1.9.4/media/css/demo_table_jui.css">  
  <link rel="stylesheet" href="DataTables-1.9.4/media/css/jquery.dataTables.css">  
  <link rel="stylesheet"  href="DataTables-1.9.4/media/css/jquery.dataTables_themeroller.css">

  
  <!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="stylesheets/foundation.min.css">
  <link rel="stylesheet" href="stylesheets/app.css">
 <script type="text/javascript" src="javascripts/moment.min.js"></script>
  <script src="javascripts/modernizr.foundation.js"></script>

  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

</head>
<body>
  <div class="row">
      <div class="seven columns">
      <h3><a href="/camel">PowerDNS Control Server</a></h3>
      </div>
      <div class="five columns">
      <br>
      <a href="/camel"><img align="right" class="logo" src="http://xs.powerdns.com/logos/powerdns-logo-154px.png"></a>
      </div>
  </div>

  <div class="row">

    <div class="twelve columns">
      <H2 id="server-name"></h2>
      <p>Running <strong><span id="version"></span></strong>, up since <span id="uptime"></span>.</p>
      <p>
      <ul class="button-group four-up even">
        <li><a href="#" class="alert button">Shutdown</a></li>
        <li><a href="#" class="button">Restart</a></li>
        <li><a href="#" class="button" onClick="$('#flushModal').reveal({close: function(){ $('#flushSpinner').html(''); }});">Flush cache</a></li>
        <li><a href="#" class="button">Deploy</a></li>
      </ul>

      <hr>
      </p>
      	<dl class="tabs">
	  <dd class="active"><a href="#graph">Graph</a></dd>
  	  <dd><a href="#simple2">Statistics</a></dd>
  	  <dd><a href="#simple3">Domains</a></dd>
  	  <dd><a href="#simple4">Configuration</a></dd>
	</dl>
	<ul class="tabs-content">
	  <li class="active" id="graphTab"></li>
	  <li id="simple2Tab"><table id="statistics"></table></li>
	  <li id="simple3Tab"><table id="domains"></table></li>	  
	  <li id="simple4Tab"><table id="config"></table></li>
	</ul>
    </div>  
  </div>
      
  <!-- Included JS Files (Compressed) -->
  <script src="javascripts/jquery.js"></script>
  <script src="javascripts/foundation.min.js"></script>
  <script src="javascripts/jquery.dataTables.min.js"></script>  
  <!-- Initialize JS Plugins -->
  <script src="javascripts/app.js"></script>
  <script src="javascripts/purl.js"></script>
  
    <script>
    $(function() {
        var url = $.url().param("url");
        $("#server-name").html($.url().param("server-name"));        
        var graphname = $.url().param("server-name").replace(new RegExp("\\.","gm"), '-');
        var graphurl='<img src="http://89.188.0.40:8085/render/?width=686&height=308&_salt=1352972312.281&areaMode=first';
        graphurl += '&target=alias(nonNegativeDerivative(pdns.'+graphname+'.recursor.questions),\'Questions\')';
        graphurl += '&target=alias(sumSeries(';
        graphurl += 'nonNegativeDerivative(pdns.'+graphname+'.recursor.answers0-1),';
        graphurl += 'nonNegativeDerivative(pdns.'+graphname+'.recursor.answers1-10),';        
        graphurl += 'nonNegativeDerivative(pdns.'+graphname+'.recursor.answers10-100),';        
        graphurl += 'nonNegativeDerivative(pdns.'+graphname+'.recursor.answers100-1000),';        
        graphurl += 'nonNegativeDerivative(pdns.'+graphname+'.recursor.answers-slow),';        
        graphurl += 'nonNegativeDerivative(pdns.'+graphname+'.recursor.packetcache-hits)), \'Answers\')';        
        
        graphurl += '&bgcolor=FFFFFF&majorGridLineColor=darkgray&minorGridLineColor=gray&fgcolor=000000">';
        $("#graphTab").html(graphurl);
        console.log(url);
	$.getJSON(url+'/?stats&callback=?', function(data) {
		var flat=[];
		$.each(data, function(e){
		  flat.push([e, data[e]]);
		  });
		  
		$("#version").html("3.5-pre"); // data["version"]);
		moment.lang('en');
		console.log("Uptime: "+data["uptime"]);
		var startup = moment().subtract('seconds', data["uptime"]);
		$("#uptime").html(startup.format('LLLL') + " ("+startup.fromNow()+")");  
		$("#statistics").dataTable( { aaData: flat, iDisplayLength:
		  50, aoColumns:
					   [{sTitle: "variable"}, {sTitle: "value"}]}); });

	$.getJSON(url+'/?config&callback=?', function(data) {
		var flat=[];
		$.each(data, function(e){
		  flat.push([e, data[e]]);
		  });
		  
		
		$("#config").dataTable( { aaData: flat, iDisplayLength:
		  50, aoColumns:
					   [{sTitle: "variable"}, {sTitle: "value"}]}); 
		$("#version").html(data["version-string"].split(" ")[2]); 
	});

	$.getJSON(url+'/?domains&callback=?', function(data) {
		var flat=[];
		$.each(data, function(key, val) {
			flat.push([val.name, val.type, val.servers, val.rdbit]);
		});
		
		$("#domains").dataTable( { aaData: flat, iDisplayLength:
		  50, aoColumns:
					   [{sTitle: "Zone"}, {sTitle: "Type"}, {sTitle: "Forward Servers"}, {sTitle: "Recursion Desired"}]}); 
		});
		



    });
    </script> 
  
</body>
</html>
